
var qform = new
function () {
    this.validall = false, this.validate = function (a, b) {
        if (!a) return false; q = $(a); ele = r(); var c = b != undefined ? b : this.validall; var d = true; for (var i = 0; i < ele.length; i++) { if (!qform.valid(ele[i], qform.showmsg)) { d = false; if (!c) return false } }
        return d
    }, this.valiing = function (a) { q = $(a); ele = r(); for (var i = 0; i < ele.length; i++) { if (!qform.valid(ele[i], qform.showmsging, false)) { $(ele[i]).keyup(function () { qform.valid(this, qform.showmsging) }); $(ele[i]).change(function () { qform.valid(this, qform.showmsging) }) } } }, this.valid = function (e, a, b) {
        var c = $(e); if (e.offsetWidth < 1 || e.offsetHeight < 1) return true; var v = $.trim(c.val()); var d = c.attr('required'); if (d && !qform.methods.required(v, e)) { var m = e.title || qform.messages.required; a && a(m, e, 'required', false); if (b) c.focus(); return false }
        if (v.length == 0) { a && a('', e, 'required', true); return true }
        d = c.attr('type') && c.attr('type').toLowerCase(); if (d && d != "text" && d != "" && qform.methods[d] && !qform.methods[d](v, e, d)) { m = e.title || qform.messages[d]; a && a(m, e, d, false); c.focus(); return false }
        for (var i in qform.features) { var f = qform.features[i]; d = c.attr(f); if (d == "") d = f; if (d && qform.methods[f] && !qform.methods[f](v, e, d)) { m = c.attr(f + 'msg') || e.title || fmtmsg(qform.messages[f], d); a && a(m, e, d, false); c.focus(); return false } }
        a && a("", e, '', true); return true
    }, this.features = ['min', 'max', 'number', 'minlength', 'maxlength', 'chs', 'zip', 'qq', 'tel', 'mobile', 'phone', 'idcard', 'pattern', 'equalto'], this.methods = {
        required: function (v, e) {
            switch (e.nodeName.toLowerCase()) { case 'select': return v && v.length > 0; case 'input': if (this.checkable(e)) return this.findByName(e.name).filter(':checked').length }
            return $.trim(v).length > 0
        }, min: function (v, e, p) { return this.pattern(v, e) || parseInt(v) >= parseInt(p) }, max: function (v, e, p) { return this.pattern(v, e) || parseInt(v) <= parseInt(p) }, minlength: function (v, e, p) { return this.pattern(v, e) || this.getLength($.trim(v), e) >= parseInt(p) }, maxlength: function (v, e, p) { return this.pattern(v, e) || this.getLength($.trim(v), e) <= parseInt(p) }, email: function (v, e) { return this.pattern(v, e) || /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(v) }, url: function (v, e) { return this.pattern(v, e) || this.isurl(v) }, number: function (v, e) { return this.pattern(v, e) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(v) }, chs: function (v, e) { return this.pattern(v, e) || /^[\u0391-\uFFE5]+$/.test(v) }, zip: function (v, e) { return this.pattern(v, e) || /^[1-9]\d{5}$/.test(v) }, qq: function (v, e) { return this.pattern(v, e) || /^[1-9]\d{4,10}$/.test(v) }, tel: function (v, e) { return this.mobile(v, e) || this.phone(v, e) }, mobile: function (v, e) { return this.pattern(v, e) || /^((\(\d{2,3}\))|(\d{3}\-))?1\d{10}$/.test(v) }, phone: function (v, e) { return this.pattern(v, e) || /^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/.test(v) }, idcard: function (m, e) { var n = function (b) { if (b.length == 18 && 18 != b.length) return false; var c = b.toLowerCase(); var d, sum = 0, v = '10x98765432', w = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2], a = '11,12,13,14,15,21,22,23,31,32,33,34,35,36,37,41,42,43,44,45,46,50,51,52,53,54,61,62,63,64,65,71,81,82,91'; var e = c.match(/^(\d{2})\d{4}(((\d{2})(\d{2})(\d{2})(\d{3}))|((\d{4})(\d{2})(\d{2})(\d{3}[x\d])))$/); if (e == null || a.indexOf(e[1]) < 0) return false; if (e[2].length == 9) { c = c.substr(0, 6) + '19' + c.substr(6); d = ['19' + e[4], e[5], e[6]].join('-') } else d = [e[9], e[10], e[11]].join('-'); if (!p.call(d, 'yyyy-MM-dd')) return false; for (var i = 0; i < 17; i++) sum += c.charAt(i) * w[i]; return (e[2].length == 9 || c.charAt(17) == v.charAt(sum % 11)) }; var p = function (f, g) { f = f || 'yyyy-MM-dd'; var h = this, o = {}, d = new Date(); var j = f.split(/[^a-z]+/gi), f2 = h.split(/\D+/g), f3 = f.split(/[a-z]+/gi), f4 = h.split(/\d+/g); var k = j.length, len1 = f3.length; if (k != f2.length || len1 != f4.length) return false; var i; for (i = 0; i < len1; i++) if (f3[i] != f4[i]) return false; for (i = 0; i < k; i++) o[j[i]] = f2[i]; o.yyyy = s(o.yyyy, o.yy, d.getFullYear(), 9999, 4); o.MM = s(o.MM, o.M, d.getMonth() + 1, 12); o.dd = s(o.dd, o.d, d.getDate(), 31); o.hh = s(o.hh, o.h, d.getHours(), 24); o.mm = s(o.mm, o.m, d.getMinutes()); o.ss = s(o.ss, o.s, d.getSeconds()); o.ms = s(o.ms, o.ms, d.getMilliseconds(), 999, 3); if (o.yyyy + o.MM + o.dd + o.hh + o.mm + o.ss + o.ms < 0) return false; if (o.yyyy < 100) o.yyyy += (o.yyyy > 30 ? 1900 : 2000); d = new Date(o.yyyy, o.MM - 1, o.dd, o.hh, o.mm, o.ss, o.ms); var l = d.getFullYear() == o.yyyy && d.getMonth() + 1 == o.MM && d.getDate() == o.dd && d.getHours() == o.hh && d.getMinutes() == o.mm && d.getSeconds() == o.ss && d.getMilliseconds() == o.ms; return l && g ? d : l; function s(a, b, c, d, e) { d = d || 60, e = e || 2; l = c; if (a != undefined && a != '' || !isNaN(a)) l = a * 1; if (b != undefined && b != '' && !isNaN(b)) l = b * 1; return (l == a && a && a.length != e || l > d) ? -10000 : l } }; return this.pattern(m, e) || n(m) }, equalto: function (v, e, p) { return v == $(p).val() }, checkable: function (a) { return /radio|checkbox/i.test(a.type) }, findByName: function (c) { var d = this.currentForm; return $(document.getElementsByName(c)).map(function (a, b) { return b.form == d && b.name == c && b || null }) }, getLength: function (a, b) {
            switch (b.nodeName.toLowerCase()) { case 'select': return $("option:selected", b).length }
            return a.length
        }, pattern: function (v, e) { return e.pattern && new RegExp(e.pattern, "g").test(v) }, isurl: function (a) { var b = '^((https|http|ftp|rtsp|mms)?://)' + '?(([0-9a-z_!~*\'().&=+$%-]+: )?[0-9a-z_!~*\'().&=+$%-]+@)?' + '(([0-9]{1,3}.){3}[0-9]{1,3}' + '|' + '([0-9a-z_!~*\'()-]+.)*' + '([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].' + '[a-z]{2,6})' + '(:[0-9]{1,4})?' + '((/?)|' + '(/[0-9a-z_!~*\'().;?:@&=+$,%#-]+)+/?)$'; var c = new RegExp(b); return c.test(a) }
    }, this.messages = { required: '什么都不写么？', pattern: '不符合验证规则', max: "请输入一个小于或等于{0}的值", min: "请输入一个大于或等于{0}的值", maxlength: "长度应小于{0}位", minlength: "长度应大于{0}位", email: "邮箱地址这样不对吧！", url: "邮箱地址这样不对吧！", number: "只能输入数字哦！", chs: '只能输入汉字哦！', zip: '邮政编码不正确！', qq: 'QQ号码不正确！', tel: '电话号码不正确', mobile: '手机号码不正确！', phone: '固定电话号码不正确！', idcard: '请输入正确的身份证号码', equalto: '输入不匹配' }, this.showmsg = function (a, e, m, b) { if (b) return; if ("undefined" != typeof qmsg && "undefined" != typeof qmsg.tip) { qform.showmsgingobj = qmsg.tip(a, e, { guide: 1, time: 60 }) } }, this.showmsging = function (a, e, m, b) {
        qform.showmsgingobj && qform.showmsgingobj.remove(); if (!b && m == 'required' && !$(e).attr('ar')) { $(e).parent().append('<span style="color: red">*</span>'); $(e).attr('ar', 'ar'); return }
        if (!b && $(e).val().length == 0 && m == 'required') { $(e).addClass('re') } else { $(e).removeClass('re') }; if (b) return; qform.showmsgingobj = qmsg.tip(a, e, { guide: 1, time: 60 })
    }, this.showmsgingobj = null; var q = null, ele = null; var r = function () { return $(':input', q).not(":submit,:button, :reset, :image, [disabled]") }, fmtmsg = function (a, v) { return a && a.replace && a.replace('{0}', v) }
}(); $.fn.qvalid = function () { return qform.validate(this) }